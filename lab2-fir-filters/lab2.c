#include <types.h>

#include "lab2.h"

// Includes only the appropriate header to the type of filter.
#if     FILTER_TYPE_SELECTED == FILTER_TYPE_LADDER
    #include "filter_ladder.h"
#elif   FILTER_TYPE_SELECTED == FILTER_TYPE_LATTICE
    #include "filter_lattice.h"
#endif

// Filter impulse response array
float impulse_response[FILTER_LENGTH] = {
    0.007779941996078346827525606954623071942   ,
    -0.007167820260809222403242113585974948364  ,
    0.05849050670872912860431824810802936554    ,
    0.015890457827997438167155763721893890761   ,
    -0.040278775567043803573774596316070528701  ,
    -0.080001520291992367361899596289731562138  ,
    -0.069264256432627346882213714707177132368  ,
    0.000140785658104214395081044131075032055   ,
    0.081712703720322715783552780521858949214   ,
    0.104124826767230477253534104420396033674   ,
    0.03592182519859755257529698724283662159    ,
    -0.076898344359357911903529725350381340832  ,
    -0.141830547483461077984401299545424990356  ,
    -0.097985424657847625118378687147924210876  ,
    0.026200417581532631228213858776143752038   ,
    0.131749649651919709114622492052149027586   ,
    0.131749649651919709114622492052149027586   ,
    0.026200417581532631228213858776143752038   ,
    -0.097985424657847625118378687147924210876  ,
    -0.141830547483461077984401299545424990356  ,
    -0.076898344359357911903529725350381340832  ,
    0.03592182519859755257529698724283662159    ,
    0.104124826767230477253534104420396033674   ,
    0.081712703720322715783552780521858949214   ,
    0.000140785658104214395081044131075032055   ,
    -0.069264256432627346882213714707177132368  ,
    -0.080001520291992367361899596289731562138  ,
    -0.040278775567043803573774596316070528701  ,
    0.015890457827997438167155763721893890761   ,
    0.05849050670872912860431824810802936554    ,
    -0.007167820260809222403242113585974948364  ,
    0.007779941996078346827525606954623071942
};

// Initializes the filter
void initialize_filter() {

#if     FILTER_TYPE_SELECTED == FILTER_TYPE_LADDER
    ladder_initialize_filter();
#elif   FILTER_TYPE_SELECTED == FILTER_TYPE_LATTICE
    lattice_initialize_filter();
#else
    return;
#endif

}

// Takes a new sample and advances the filter state.
void take_sample(uint16_t sample) {

#if     FILTER_TYPE_SELECTED == FILTER_TYPE_LADDER
    ladder_take_sample(sample);
#elif   FILTER_TYPE_SELECTED == FILTER_TYPE_LATTICE
    lattice_take_sample(sample);
#else
    return;
#endif

}

// Calculates the next output sample, based on the current filter state.
uint16_t next_sample() {

#if     FILTER_TYPE_SELECTED == FILTER_TYPE_LADDER
    return ladder_next_sample();
#elif   FILTER_TYPE_SELECTED == FILTER_TYPE_LATTICE
    return lattice_next_sample();
#else
    return 0;
#endif

}
